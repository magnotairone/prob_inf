# Parte 1: Espaço de Probabilidade

::: {#def-experimento-aleatorio name="Experimento Aleatório"}
Chamamos de **experimento aleatório** todo e qualquer experimento tal que quando repetido sob as mesmas condições, o resultado obtido nem sempre é o mesmo.
:::

::: {#exm-experimentos-aleatorios name="Exemplo 1.1"}
a) Um usuário visita um site e observa-se se ele clica (1) ou não clica (0) em um anúncio específico (Teste A/B). $\Omega=\{0,1\}$.
b) Um algoritmo de detecção de fraude analisa transações sequencialmente até encontrar a primeira anomalia. Observa-se o número de transações analisadas. $\Omega=\mathbb{N}^{*}=\{1,2,3,...\}$.
c) Seleciona-se, ao acaso, um cliente de uma base de dados e observa-se seu *score* de crédito (normalizado). $\Omega=(0,1)$.
:::

::: {#def-espaco-amostral name="Espaço Amostral"}
Chamamos de **espaço amostral**, e denotamos por $\Omega$, o conjunto de todos os possíveis resultados do experimento aleatório.
$\Omega=\{\omega_{1}, \omega_{2}, ...\}$

Para cada experimento, podemos definir eventos de interesse.
:::

::: {#exm-eventos name="Exemplo 1.2"}
(cont. @exm-experimentos-aleatorios)

a) A="usuário não clicou no anúncio"; $A=\{0\}$.
b) B="exatamente duas transações foram analisadas até a primeira detecção"; $B=\{2\}$.
c) C="*score* de crédito é maior que 2"; $C=\emptyset$ (impossível, dado $\Omega=(0,1)$).
:::

## Um Espaço de Probabilidade

Um espaço de probabilidade tem três componentes:

1.  Um conjunto $\Omega$ formado pelos resultados do experimento aleatório (espaço amostral).
2.  Uma classe de subconjuntos de $\Omega$, denotada aqui por $\mathcal{F}$, chamados de **eventos aleatórios**. São os conjuntos de $\mathcal{F}$ que gostaríamos de "medir" (atribuir probabilidade).
3.  Uma função $\mathbb{P}$ que associa a cada evento aleatório em $\mathcal{F}$ um número real, chamada **probabilidade** ou **medida de probabilidade**.

> **Perspectiva de Data Science: O Data Frame como Espaço Amostral**
>
> Como podemos traduzir esses conceitos para o nosso dia a dia?
>
> * **$\Omega$ (Espaço Amostral):** Pense em $\Omega$ como o seu **data frame ou tabela inteira** (`df`). É o universo de todas as observações possíveis que seu experimento (coleta de dados) poderia gerar.
> * **$\omega$ (Resultado):** Um $\omega$ (um elemento de $\Omega$) é uma **única linha** do seu data frame. Pode ser um usuário (`user_id = 123`), uma transação (`transaction_id = 9A8B`), ou uma sessão de site.
> * **$A$ (Evento):** Um evento $A$ (um subconjunto de $\Omega$) é o resultado de uma **consulta (`query`) ou filtro (`subset`)** que você aplica ao seu data frame.
>
> Por exemplo:
> * `df[df$segmento == "VIP", ]` é o evento $A = \text{"Clientes VIP"}$.
> * `df[df$clicou == 1 & df$pais == "BR", ]` é o evento $B \cap C$, onde $B = \text{"Clicou"}$ e $C = \text{"Brasil"}$.
>
> A Teoria da Probabilidade nos dá as regras formais para calcular o "tamanho" (a probabilidade) desses subconjuntos.

Gostaríamos, em princípio, de atribuir probabilidade a qualquer subconjunto de $\Omega$, isto é, considerar $\mathcal{F}=\mathcal{P}(\Omega)$ (conjunto das partes de $\Omega$).

Se $\Omega$ for finito ou infinito enumerável, isso é possível. Se $\Omega$ for não enumerável, por ex. $\Omega=\mathbb{R}^{2}$, existem subconjuntos de $\Omega$ aos quais não é possível "medir" (veja, por ex. Rolla & Lima, Problema da Agulha de Buffon, p. 27).

Ideia: Restringir $\mathcal{F}$.

Vamos exigir o seguinte para $\mathcal{F}$:

::: {#def-sigma-algebra name="$\sigma$-álgebra"}
Dizemos que uma classe $\mathcal{F}$ de subconjuntos de $\Omega$ é uma **$\sigma$-álgebra** se $\mathcal{F}$ satisfaz:

i) $\Omega \in \mathcal{F}$.
ii) $\forall A \in \mathcal{F} \Rightarrow A^{c} \in \mathcal{F}$.
iii) Se $A_{1}, A_{2}, ... \in \mathcal{F} \Rightarrow \bigcup_{n=1}^{\infty} A_{n} \in \mathcal{F}$.
:::

> **Perspectiva de Data Science: A $\sigma$-álgebra como o *Schema* dos Dados**
>
> O conceito de $\sigma$-álgebra ($\mathcal{F}$) é um dos mais abstratos, mas tem uma analogia prática: pense em $\mathcal{F}$ como as **"perguntas que o seu *schema* de dados permite fazer"**.
>
> O $\mathcal{F}$ define quais eventos são "mensuráveis". Em Data Science, isso é definido pelas *features* (colunas) que você coletou.
>
> * Se seu data frame $\Omega$ tem colunas `idade` e `genero`, sua $\sigma$-álgebra $\mathcal{F}$ permite "medir" (filtrar, agrupar, calcular probabilidades) eventos como "clientes com mais de 30 anos" ($A$) ou "clientes do gênero feminino" ($B$).
> * As propriedades da $\sigma$-álgebra garantem que você também pode medir combinações:
>     * (ii) `NOT` $A$: "clientes com 30 anos ou menos" ($A^c$).
>     * (iii) $A \cup B$: "clientes com mais de 30 anos **OU** femininos".
>     * (Prop. 1.1) $A \cap B$: "clientes femininos com mais de 30 anos".
>
> Se uma *feature* não foi coletada (ex: `renda`), eventos como "clientes com renda > 10k" **não estão** em $\mathcal{F}$. Não podemos medir sua probabilidade porque essa informação não existe no nosso espaço. A $\sigma$-álgebra é, portanto, o conjunto de todas as *queries* que podemos construir a partir das colunas disponíveis.

::: {#exm-sigma-partes name="Exemplo 1.3"}
$\Omega \neq \emptyset$ qualquer. $\mathcal{F}=\mathcal{P}(\Omega)=\{A:A\subseteq\Omega\}$ é $\sigma$-algebra (maior $\sigma$-algebra).

De fato, $\mathcal{P}(\Omega)$ é uma $\sigma$-álgebra (maior $\sigma$-álgebra):

i) $\Omega \in \mathcal{F}=\mathcal{P}(\Omega)$.
ii) $A \in \mathcal{F} \Rightarrow A^{c} \in \mathcal{F}$.
iii) $A_{1}, A_{2}, ... \in \mathcal{F} \Rightarrow \bigcup_{i=1}^{\infty} A_{i} \in \mathcal{F}$.
:::

::: {#exm-sigma-trivial name="Exemplo 1.4"}
$\Omega \neq \emptyset$ qualquer.
$\mathcal{F}=\{\emptyset, \Omega\}$ ($\sigma$-álgebra trivial).
:::

::: {#exm-sigma-subconjunto-b name="Exemplo 1.5"}
$\Omega$ qualquer e $B \subseteq \Omega$.
$\mathcal{F}=\{\emptyset, \Omega, B, B^{c}\}$ (menor $\sigma$-álgebra que contém B).
:::

::: {#prp-propriedades-sigma name="Proposição 1.1"}
Se $\mathcal{F}$ é $\sigma$-álgebra em $\Omega$, então:

i) $\emptyset \in \mathcal{F}$.
ii) $A_{1}, A_{2}, ... \in \mathcal{F} \Rightarrow \bigcap_{n=1}^{\infty} A_{n} \in \mathcal{F}$.
iii) Se $A, B \in \mathcal{F} \Rightarrow A-B \in \mathcal{F}$, $A-B=A \cap B^{c}$.

**Demonstração**:

Seja $\mathcal{F}$ uma $\sigma$-álgebra em $\Omega$.

i) $\Omega \in \mathcal{F} \Rightarrow \Omega^{c} \in \mathcal{F} \Rightarrow \emptyset \in \mathcal{F}$.
ii) $A_{1}, A_{2}, ... \in \mathcal{F} \Rightarrow A_{1}^{c}, A_{2}^{c}, ... \in \mathcal{F} \Rightarrow \bigcup_{n=1}^{\infty} A_{n}^{c} \in \mathcal{F}$.
$\Rightarrow (\bigcup_{n=1}^{\infty} A_{n}^{c})^{c} \in \mathcal{F} \Rightarrow \bigcap_{n=1}^{\infty} A_{n} \in \mathcal{F}$.
:::

::: {#prp-interseccao-sigma name="Proposição 1.2"}
Sejam $\mathcal{F}_{1}, \mathcal{F}_{2}$ duas $\sigma$-álgebras de subconjuntos de $\Omega$. Então $\mathcal{F}_{1} \cap \mathcal{F}_{2}$ é, também, $\sigma$-álgebra de $\Omega$.

**Demonstração**:

Sejam $\mathcal{F}_{1}, \mathcal{F}_{2}$ $\sigma$-álgebras de subconj. de $\Omega$.

i) $\begin{cases} \Omega \in \mathcal{F}_{1} \\ e \\ \Omega \in \mathcal{F}_{2} \end{cases} \Rightarrow \Omega \in \mathcal{F}_{1} \cap \mathcal{F}_{2}$
ii) $A \in \mathcal{F}_{1} \cap \mathcal{F}_{2} \Rightarrow \begin{cases} A \in \mathcal{F}_{1} \Rightarrow A^{c} \in \mathcal{F}_{1} \\ A \in \mathcal{F}_{2} \Rightarrow A^{c} \in \mathcal{F}_{2} \end{cases} \Rightarrow A^{c} \in \mathcal{F}_{1} \cap \mathcal{F}_{2}$
iii) $A_{1}, A_{2}, ... \in \mathcal{F}_{1} \cap \mathcal{F}_{2}$, então $\begin{cases} \bigcup_{n=1}^{\infty} A_{n} \in \mathcal{F}_{1} \\ \bigcup_{n=1}^{\infty} A_{n} \in \mathcal{F}_{2} \end{cases} \Rightarrow \bigcup_{n=1}^{\infty} A_{n} \in \mathcal{F}_{1} \cap \mathcal{F}_{2}$
:::

## $\sigma$-algebra Gerada


Seja $\Omega \neq \emptyset$ e $\mathcal{C}$ uma classe de subconjuntos de $\Omega$, isto é, $\mathcal{C} \subseteq \mathcal{P}(\Omega)$.

Para toda classe $\mathcal{C} \subseteq \mathcal{P}(\Omega)$, existe ao menos uma $\sigma$-álgebra que contém $\mathcal{C}$, a saber $\mathcal{P}(\Omega)$.

Em geral, seja $\mathcal{C} \subseteq \mathcal{P}(\Omega)$. Definamos $\mathbb{F}(\mathcal{C})$ o conjunto de todas as $\sigma$-álgebras de $\Omega$ que contêm $\mathcal{C}$.

Note que $\mathbb{F}(\mathcal{C}) \neq \emptyset$, pois $\mathcal{P}(\Omega) \in \mathbb{F}(\mathcal{C})$.

Defina
$$\sigma(\mathcal{C}) = \bigcap_{\mathcal{F} \in \mathbb{F}(\mathcal{C})} \mathcal{F}$$

Então $\sigma(\mathcal{C})$ é a "menor" $\sigma$-álgebra que contém $\mathcal{C}$ ($\sigma$-álgebra gerada por $\mathcal{C}$).

::: {#exm-sigma-gerada-finita name="Exemplo 1.6"}
Sejam $\Omega=\{1,2,3,4,5,6\}$ e $\mathcal{C}=\{\{1,2,3,4\},\{5,6\}\}$.

Temos que
$\mathcal{F}_{1}=\{\emptyset, \Omega, \{1,2,3,4\}, \{5,6\}\}$
e
$\mathcal{F}_{2}=\{\emptyset, \Omega, \{1,2\}, \{3,4\}, \{5,6\}, \{1,2,3,4\}, \{1,2,5,6\}, \{3,4,5,6\}\}$
são $\sigma$-álgebras que contêm $\mathcal{C}$.

Note que $\mathcal{F}_{1}$ é a menor $\sigma$-álgebra que contém $\mathcal{C}$, isto é, $\sigma(\mathcal{C})$.
:::

::: {#exm-sigma-borel name="Exemplo 1.7"}
Sejam $\Omega=\mathbb{R}$ e $\mathcal{C}=\{(-\infty, x] : x \in \mathbb{R}\}$.

A $\sigma(\mathcal{C})$ é chamada de **$\sigma$-álgebra de Borel** em $\mathbb{R}$.

Notação: $\sigma(\mathcal{C}) = \mathcal{B}(\mathbb{R}) = \mathcal{B}$.

Se $B \in \mathcal{B}(\mathbb{R})$, dizemos que B é um **Boreliano**.
(será o domínio da função de probabilidade).
:::

## Implementação Prática em R

Nesta seção, ilustramos os conceitos de Espaço Amostral ($\Omega$) e Eventos ($\mathcal{F}$) usando R. Em ciência de dados, frequentemente lidamos com $\Omega$ como o conjunto de todas as observações (linhas) em um *dataset*.

### Espaço Amostral Finito: Segmentação de Clientes

Vamos usar o contexto do @exm-sigma-gerada-finita. Nosso espaço amostral $\Omega$ é o conjunto de 6 segmentos de clientes.

```{r}
# Nosso espaço amostral (universo)
Omega <- 1:6
print(Omega)
```

Um evento $A$ é um subconjunto de $\Omega$. Por exemplo, o evento "Segmento de Alta Prioridade".

```{r}
# Evento A: "Alta Prioridade"
A <- c(1, 2, 3, 4)

# Evento B (complementar de A): "Baixa Prioridade"
B <- c(5, 6)
```

A $\sigma$-álgebra $\mathcal{F}$ define quais perguntas podemos "fazer" aos nossos dados. A $\sigma$-álgebra gerada por $\mathcal{C}=\{A, B\}$ (como no Exemplo 1.6, onde $B=A^c$) é:

$\mathcal{F} = \{\emptyset, \Omega, A, B\}$

Vamos verificar as propriedades da $\sigma$-álgebra em R:

```{r}
# (i) Omega está em F
# (Omega já foi definido)

# (ii) O complemento de um evento em F também está em F
# A complemento (A^c) em relação a Omega
A_comp <- setdiff(Omega, A)
print(paste("Complemento de A:", list(A_comp)))

# B complemento (B^c) em relação a Omega
B_comp <- setdiff(Omega, B)
print(paste("Complemento de B:", list(B_comp)))

# Note que A_comp é B, e B_comp é A. Ambos estão em F.

# (iii) A união de eventos em F está em F
A_union_B <- union(A, B)
print(paste("União de A e B:", list(A_union_B)))
# Note que a união é o próprio Omega, que está em F.
```

### Eventos como Subconjuntos de um Data Frame

Na prática, $\Omega$ é muitas vezes o conjunto de todas as unidades observacionais (ex: todos os usuários, todas as transações). Os eventos são subconjuntos (filtros) desse *dataset*.

```{r}
# Criando um Omega (nosso dataset de usuários)
set.seed(42) # Para reprodutibilidade
Omega_data <- data.frame(
  user_id = 1:100,
  segmento = sample(c("VIP", "Regular", "Novo"), 100, replace = TRUE),
  clicou_anuncio = sample(c(0, 1), 100, replace = TRUE)
)

# head(Omega_data)
```

Aqui, $\Omega$ é o conjunto dos 100 `user_id`s.

Vamos definir alguns eventos:

* $A$: Usuários que são "VIP".
* $B$: Usuários que "clicaram no anúncio" (resultado 1).

```{r}
# Evento A: "Usuário é VIP"
A <- subset(Omega_data, segmento == "VIP")
cat("Número de elementos em A (VIPs):", nrow(A), "\n")

# Evento B: "Usuário clicou"
B <- subset(Omega_data, clicou_anuncio == 1)
cat("Número de elementos em B (Clicaram):", nrow(B), "\n")
```

Podemos usar as operações de conjunto (que são a base da $\sigma$-álgebra) para definir eventos mais complexos:

```{r}
# 1. Evento Complemento: A^c (Não-VIPs)
# A^c = Omega - A
A_comp <- subset(Omega_data, segmento != "VIP")
cat("Número de elementos em A^c (Não-VIPs):", nrow(A_comp), "\n")

# 2. Evento Interseção: A ∩ B (Usuários VIP que clicaram)
A_inter_B <- subset(Omega_data, segmento == "VIP" & clicou_anuncio == 1)
# ou
# A_inter_B <- merge(A, B)
cat("Número de elementos em A ∩ B (VIPs que clicaram):", nrow(A_inter_B), "\n")

# 3. Evento União: A U B (Usuários que são VIP ou clicaram)
A_union_B <- subset(Omega_data, segmento == "VIP" | clicou_anuncio == 1)
cat("Número de elementos em A U B (VIPs ou clicaram):", nrow(A_union_B), "\n")
```

Este exercício mostra como as operações teóricas de $\sigma$-álgebra (complemento, união, interseção) são mapeadas diretamente para as operações de filtro (E/OU/NÃO) que usamos diariamente em R (e SQL) para análise de dados.